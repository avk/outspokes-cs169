<%= javascript_include_tag :defaults %>

<p id="invited_message">
  <%- unless @total_commenters == 0 -%>
  You've invited <strong id="invite_count"><%= pluralize(@total_commenters, 'person') %></strong> to give feedback.
  <% end -%>
</p>

<%- unless @commenters_commented.empty? -%>
<p>Gave Feedback</p>
<ol id="site_commenters_commented">
  <%- @commenters_commented.each do |commenter| -%>
  <li class="invited_commenter">
    <div class="remove_commenter">
      <%= link_to 'X', 
      admin_panel_uninvite_path(@site, @site.validation_token, commenter), 
      :confirm => "This will remove all of #{commenter.email}'s feedback and prevent him or her from leaving new feedback. Are you sure?", 
      :method => :delete %>
    </div>
    <div class="commenter_email">
      <%- if RAILS_ENV == "development" -%>
      <% final_url = @site.home_page.url.sub(/\/$/i, '') + '?url_token=' + commenter.invites.find_by_page_id(@site.home_page.id).url_token %>
      <%= link_to commenter.truncated_email, final_url %>
      <%- else -%>
      <%= commenter.truncated_email %> 
      <% end -%>
    </div>
</li>
<% end -%>
</ol>
<%- end -%>

<%- unless @commenters_visited.empty? -%>
<p>Visited</p>
<ol id="site_commenters_visited">
  <%- @commenters_visited.each do |commenter| -%>
  <li class="invited_commenter">
    <div class="remove_commenter">
      <%= link_to 'X', 
      admin_panel_uninvite_path(@site, @site.validation_token, commenter), 
      :confirm => "This will remove all of #{commenter.email}'s feedback and prevent him or her from leaving new feedback. Are you sure?", 
      :method => :delete %>
    </div>
    <div class="commenter_email">
      <%- if RAILS_ENV == "development" -%>
      <% final_url = @site.home_page.url.sub(/\/$/i, '') + '?url_token=' + commenter.invites.find_by_page_id(@site.home_page.id).url_token %>
      <%= link_to commenter.truncated_email, final_url %>
      <%- else -%>
      <%= commenter.truncated_email %>
      <% end -%>
      visited 
      <%= relative_date Date.parse(commenter.last_visited_at.to_s) %> @
      <%= prettier_time Time.parse(commenter.last_visited_at.to_s) %>
    </div>
  </li>
  <% end -%>
</ol>
<%- end -%>

<%- unless @commenters_not_visited.empty? -%>
<p>Didn't Visit Yet</p>
<ol id="site_commenters_not_visited">
  <%- @commenters_not_visited.each do |commenter| -%>
  <li class="invited_commenter">
    <div class="remove_commenter">
      <%= link_to 'X', 
      admin_panel_uninvite_path(@site, @site.validation_token, commenter), 
      :confirm => "This will remove all of #{commenter.email}'s feedback and prevent him or her from leaving new feedback. Are you sure?", 
      :method => :delete %>
    </div>
    <div class="commenter_email">
      <%- if RAILS_ENV == "development" -%>
        <% final_url = @site.home_page.url.sub(/\/$/i, '') + '?url_token=' + commenter.invites.find_by_page_id(@site.home_page.id).url_token %>
        <%= link_to commenter.truncated_email, final_url %>
      <%- else -%>
        <%= commenter.truncated_email %>
      <% end -%>
    </div>
  </li>
  <% end -%>
</ol>
<%- end -%>


<fieldset id="invite_commenters">
  <legend>Invite <%= (@total_commenters == 0) ? 'some' : 'more' %> folks</legend>

  <% form_tag admin_panel_invite_path(@site) do %>
    <%= label_tag 'emails', "Comma-separated emails" %><br />
    <%= text_area_tag :emails %><br />
    <%= submit_tag 'Invite' %>
  <% end %>
</fieldset>
